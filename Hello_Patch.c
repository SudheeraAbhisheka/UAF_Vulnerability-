#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

void exploit();
void calcPrime();
void printArray(int* a, int length);

typedef struct {
	uint8_t methodName[20];
	uintptr_t (*func)();
} Object;

void doProcess(Object* obj) {
	//printf("[+] Calling %s\n", obj->methodName);
	(*obj->func)();
}

int main(int argc, char **argv) {

  printf("\n");
	printf("#######################################################\n");
	printf("# WELCOME TO PRIME NUMBER GENERATOR                   #\n");
	printf("#######################################################\n");
	printf("# This tool will generate prime numbers upto 100      #\n");
	printf("#######################################################\n");

	Object *oThing = (void *)malloc(sizeof(Object));
	oThing->func = (void *)calcPrime;
	strcpy(oThing->methodName, "calcPrime_method");


	doProcess(oThing);
	free(oThing);

	uint8_t *userInput = (void *)malloc(32);
	read(STDIN_FILENO, userInput, 32);

	Object *oThing2 = (void *)malloc(sizeof(Object));
	oThing->func = (void *)calcPrime;
	strcpy(oThing->methodName, "calcPrime_method");
    doProcess(oThing2); 

	return 0;
}

void calcPrime() {
	int num, bool, i;
	int arr[26];
	int count = 0;
  num = 0;
	
  while(num < 100)
  {
    bool = 1;
    for(i = 2; i < 100; i++)
    {
      if(num % i == 0 && num != i)
      {
          bool = 0;
      }
    }

    if(bool)
    {
      arr[count] = num;
      count++;
    }
    num++;
  }
  printArray(arr, count);
}

void printArray(int* a, int length) {
  printf("\n\nPRINTING ARRAY\n\n");
  int i;
  for(i = 0; i < length; i++) {
    // if at end of first row, add closing bar and new line
    if(i%10 == 0 && i != 0) {
      printf("|\n");
    }
    printf("|%6d", a[i]);
  }
  printf("|\n\n");
}

void exploit() {
  system("/bin/bash");
  //printf("Exploited");
}
