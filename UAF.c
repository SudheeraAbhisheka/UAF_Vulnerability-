#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

void exploit() { printf("Program exploited with Use After Free!"); }
void goodfun() { printf("The original function call"); }

typedef struct {
	uint8_t methodName[20];
	uintptr_t (*func)();
} Object;

void doProcess(Object* obj) {
	printf("[+] Calling %s\n", obj->methodName);
	(*obj->func)();
}

int main(int argc, char **argv) {
	Object *oThing = (void *)malloc(sizeof(Object));
	oThing->func = (void *)goodfun;
	strcpy(oThing->methodName, "goodfun_method");


	doProcess(oThing);
	free(oThing);

	uint8_t *userInput = (void *)malloc(32);
	read(STDIN_FILENO, userInput, 32);

	doProcess(oThing); 

	return 0;
}